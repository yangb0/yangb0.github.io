(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{283:function(n,t,e){"use strict";e.r(t);var a=e(0),s=Object(a.a)({},function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("p",[n._v("​\t前面了解了Elasticsearch中对索引及文档的基本操作。今天了解Es中非常重要的一个概念:分词。在 Elasticsearch  中，中文分词的首选分词器是 ik 分词器。在本文中，我们将介绍如何使用 ik 分词器将商品名称（name）字段进行分词，并详细介绍分词过程及结果等。")]),n._v(" "),e("h2",{attrs:{id:"一、ik分词简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、ik分词简介","aria-hidden":"true"}},[n._v("#")]),n._v(" 一、ik分词简介")]),n._v(" "),e("p",[n._v("ik分词是一个中文分词器，是基于lucene开发的开源项目，可以通过Elasticsearch的插件方式集成到Elasticsearch中。相对于其他分词器，ik分词的特点在于：")]),n._v(" "),e("ol",[e("li",[n._v("更加细致的切分能力")]),n._v(" "),e("li",[n._v("支持自定义词典")]),n._v(" "),e("li",[n._v("支持拼音转换")]),n._v(" "),e("li",[n._v("支持多种分词模式")])]),n._v(" "),e("p",[n._v("由于ik分词具有良好的中文分词效果，因此在Elasticsearch中使用ik分词插件进行搜索的应用非常广泛。")]),n._v(" "),e("h2",{attrs:{id:"二、安装-ik-分词器插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、安装-ik-分词器插件","aria-hidden":"true"}},[n._v("#")]),n._v(" 二、安装 ik 分词器插件")]),n._v(" "),e("p",[n._v("首先，我们需要安装 ik 分词器插件。进入github中ik分词器的源码地址里下载，https://github.com/medcl/elasticsearch-analysis-ik。我们需要根据Es的版本下载对应的分词包。这里我们下载的是v7.11.2：")]),n._v(" "),e("p",[e("img",{attrs:{src:"/assets/img/image-20230609114242346.png",alt:"image-20230609114242346"}})]),n._v(" "),e("p",[n._v("由于前面我们使用Docker安装Elasticsearch时已经将Es的plugins目录映射出来了，这里我们只需要将分词包放到映射出来的plugins目录中，重启 Elasticsearch即可生效。")]),n._v(" "),e("h2",{attrs:{id:"三、使用介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、使用介绍","aria-hidden":"true"}},[n._v("#")]),n._v(" 三、使用介绍")]),n._v(" "),e("h3",{attrs:{id:"_1-分词模式介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-分词模式介绍","aria-hidden":"true"}},[n._v("#")]),n._v(" 1.分词模式介绍")]),n._v(" "),e("p",[n._v("ik分词器有两种分词模式：ik_max_word和ik_smart模式。")]),n._v(" "),e("ul",[e("li",[n._v('"ik_smart"：是一种比较快速的分词算法，它会尽可能地将文本切分成一个个意义明确的词语。但是可能会出现一些有歧义的结果。')]),n._v(" "),e("li",[n._v('"ik_max_word"：是一种更加细致、准确的分词算法，它不仅会将文本切分成一个个意义明确的词语，还会考虑到词语之间的关联性，以保证最大化整体语义的准确性。但是“ik_max_word”分词算法相比于“ik_smart”分词算法在效率上有所降低。')])]),n._v(" "),e("p",[n._v("因此，如果你对分词效率有要求，并且可以容忍一定的歧义性结果，可以选择使用“ik_smart”分词算法；如果你更注重分词的准确性，可以选择使用“ik_max_word”分词算法。")]),n._v(" "),e("p",{staticStyle:{color:"red"}},[n._v("最佳实践：两种分词器使用的最佳实践是：索引时用ik_max_word，在搜索时用ik_smart。即：索引时最大化的将文章内容分词，搜索时更精确的搜索到想要的结果。")]),n._v(" "),e("h3",{attrs:{id:"_2-使用示例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用示例","aria-hidden":"true"}},[n._v("#")]),n._v(" 2.使用示例")]),n._v(" "),e("p",[n._v("在创建商品索引product-test时，需要在商品名称字段上指定使用ik分词器。具体做法如下：")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('PUT /product-test\n{\n  "mappings": {\n    "properties": {\n      "name": {\n        "type": "text",\n        "analyzer": "ik_max_word"\n      },\n      "image": {\n        "type": "keyword"\n      },\n      "price": {\n        "type": "float"\n      },\n      "quantity": {\n        "type": "integer"\n      }\n    }\n  }\n}\n')])])]),e("p",[n._v("在上述代码中，我们使用了ik_max_word分词器来对商品名称进行分词处理。为了验证商品名称已经正确地使用了ik_max_word分词器进行了分词处理，我们可以通过以下命令获取商品名称字段的分词结果：")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('POST /product-test/_analyze\n{\n  "analyzer": "ik_max_word",\n  "text": "苹果手机 XR 64G"\n}\n')])])]),e("p",[n._v("执行上述命令后，我们可以得到如下的分词结果：")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('{\n  "tokens" : [\n    {\n      "token" : "苹果",\n      "start_offset" : 0,\n      "end_offset" : 2,\n      "type" : "CN_WORD",\n      "position" : 0\n    },\n    {\n      "token" : "苹",\n      "start_offset" : 0,\n      "end_offset" : 1,\n      "type" : "CN_WORD",\n      "position" : 1\n    },\n    {\n      "token" : "果",\n      "start_offset" : 1,\n      "end_offset" : 2,\n      "type" : "CN_WORD",\n      "position" : 2\n    },\n    {\n      "token" : "手机",\n      "start_offset" : 2,\n      "end_offset" : 4,\n      "type" : "CN_WORD",\n      "position" : 3\n    },\n    {\n      "token" : "手",\n      "start_offset" : 2,\n      "end_offset" : 3,\n      "type" : "CN_WORD",\n      "position" : 4\n    },\n    {\n      "token" : "机",\n      "start_offset" : 3,\n      "end_offset" : 4,\n      "type" : "CN_WORD",\n      "position" : 5\n    },\n    {\n      "token" : "xr",\n      "start_offset" : 5,\n      "end_offset" : 7,\n      "type" : "ENGLISH",\n      "position" : 6\n    },\n    {\n      "token" : "64g",\n      "start_offset" : 8,\n      "end_offset" : 11,\n      "type" : "LETTER",\n      "position" : 7\n    },\n    {\n      "token" : "64",\n      "start_offset" : 8,\n      "end_offset" : 10,\n      "type" : "ARABIC",\n      "position" : 8\n    },\n    {\n      "token" : "g",\n      "start_offset" : 10,\n      "end_offset" : 11,\n      "type" : "ENGLISH",\n      "position" : 9\n    }\n  ]\n}\n\n')])])]),e("p",[n._v("从分词结果可以看出，商品名称被成功地切分成了若干个词汇。")]),n._v(" "),e("p",[n._v("为了演示如何通过分词搜索商品名称，我们往索引中添加一些数据。")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('\nPOST /product-test/_bulk\n{ "index": { "_id": 1 }}\n{ "name": "苹果12 Pro Max", "image": "https://images.com/iphone12promax.jpg", "price": 4000, "quantity": 50 }\n{ "index": { "_id": 2 }}\n{ "name": "Samsung Galaxy S21 Ultra", "image": "https://images.com/SamsungS21.jpg", "price": 5200, "quantity": 100 }\n{ "index": { "_id": 3 }}\n{ "name": "苹果14 Mini", "image": "https://images.com/iphone14mini.jpg", "price": 5999, "quantity": 200 }\n{ "index": { "_id": 4 }}\n{ "name": "苹果14 Pro Max", "image": "https://images.com/iphone12promax.jpg", "price": 8999, "quantity": 250 }\n{ "index": { "_id": 5 }}\n{ "name": "华为Mate 40 Pro", "image": "https://images.com/HuaweiMate40.jpg", "price": 5999, "quantity": 50 }\n{ "index": { "_id": 6 }}\n{ "name": "小米14", "image": "https://images.com/xiaomi14.jpg", "price": 5999, "quantity": 50 }\n')])])]),e("p",[n._v("我们可以使用以下代码来进行搜索：")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('GET /product-test/_search\n{\n  "query": {\n    "match": {\n      "name": "苹果"\n    }\n  }\n}\n')])])]),e("p",[n._v("执行上述命令后，我们可以得到如下的搜索结果：")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('{\n  "took" : 0,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 1,\n    "successful" : 1,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : {\n      "value" : 3,\n      "relation" : "eq"\n    },\n    "max_score" : 4.0781574,\n    "hits" : [\n      {\n        "_index" : "product-test",\n        "_type" : "_doc",\n        "_id" : "3",\n        "_score" : 4.0781574,\n        "_source" : {\n          "name" : "苹果14 Mini",\n          "image" : "https://images.com/iphone14mini.jpg",\n          "price" : 5999,\n          "quantity" : 200\n        }\n      },\n      {\n        "_index" : "product-test",\n        "_type" : "_doc",\n        "_id" : "1",\n        "_score" : 3.761748,\n        "_source" : {\n          "name" : "苹果12 Pro Max",\n          "image" : "https://images.com/iphone12promax.jpg",\n          "price" : 4000,\n          "quantity" : 50\n        }\n      },\n      {\n        "_index" : "product-test",\n        "_type" : "_doc",\n        "_id" : "4",\n        "_score" : 3.761748,\n        "_source" : {\n          "name" : "苹果14 Pro Max",\n          "image" : "https://images.com/iphone12promax.jpg",\n          "price" : 8999,\n          "quantity" : 250\n        }\n      }\n    ]\n  }\n}\n\n')])])]),e("p",[n._v("从搜索结果可以看出，通过使用ik_max_word分词器对商品名称进行分词处理后，我们可以轻松地将商品名称包含“苹果”的商品搜索出来。 同样 当我们搜索 “14” 的时候 ，我们会把“小米14”、“苹果14 Mini”、“苹果14 Pro Max”的结果搜索出来。")])])},[],!1,null,null,null);t.default=s.exports}}]);